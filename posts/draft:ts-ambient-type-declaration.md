---
title: Ambient Type Declaration
date: "2022-05-07"
summary: .d.ts 파일은 언제 쓰는 걸까
---

타입스크립트의 타입 선언은 `.ts, .tsx` 확장자를 가진 파일에서도 할 수 있지만 `.d.ts` 확장자를 가진 파일에서도 할 수 있습니다.

## `.d.ts` 란?

`.d.ts` 확장자를 가진 파일에서는 타입 선언만 할 수 있고 값을 표현할 수는 없습니다. 값을 포함하는 일반적인 선언과 구별하기 위해 `d.ts` 확장자를 가진 파일에서의 하는 타입 선언에 앰비언트(ambient; 주위의, 주변의)라는 표현을 붙여서 일반적으로 **앰비언트 타입 선언**이라고 부릅니다.

## 앰비언트 타입 선언의 특징

앰비언트 타입 선언의 가장 큰 특징은 타입만 포함할 수 있고 값은 표현할 수 없다는 점입니다. 타입스크립트에서 class는 타입으로도 값으로도 사용되지만, d.ts 안에서는 타입 선언만 할 수 있고 메서드의 구체적인 구현이나 프로퍼티의 할당은 할 수 없습니다.

다만 값을 정의할 수는 없지만, `declare` 라는 특별 키워드를 사용해 JS의 다른 어딘가에 값이 있다는 사실을 선언할 수 있습니다.
`declare` 는 "나의 자바스크립트는 이 타입을 익스포트함을 맹세한다"라고 선언하는 것이라 생각하면 좋습니다.

또 다른 특징으로는 영향 범위가 전역이라는 점입니다. 즉, 앰비언트 타입 선언은 전역 스코프에 선언이 되는 것과 동일합니다. 명시적으로 `import` 하지 않더라도 어디서든 사용할 수 있습니다.

## 언제 앰비언트 타입 선언이 주로 사용되나요

`.ts, .tsx`확장자를 가진 파일에서는 타입 선언과 구현을 모두 할 수 있으므로 일반적으로 앰비언트 타입 선언을 사용하여 타입 선언과 구현을 분리할 필요는 없습니다. 그럼 반대로 타입 선언과 구현을 같이 할 수 없는 상황을 생각해 보면, 언제 앰비언트 타입 선언을 사용해야 하는지 알 수 있습니다.

### 타입 선언이 없는 js로 작성된 서드 파티 라이브러리

DefinitelyTyped 를 잠시 잊어보겠습니다. js로 작성된 npm library 가 있다고 가정해보겠습니다. 이미 구현체는 npm에 존재하지만 이에 대한 타입 선언은 없습니다. 타입스크립트에서 사용은 가능하나 타입 선언이 없으므로 import 한 모듈은 모두 any 로 추론될 것입니다. tsconfig.json 설정에 따라 any 사용을 금지하였다면 컴파일조차 되지 않을 것입니다. 이러한 경우에 앰비언트 타입 선언을 사용할 수 있습니다. 앰비언트 타입 선언으로 구현체의 타입만을 선언해주면, tsc(컴파일러)는 자동으로 d.ts 파일을 검색해서 타입 체킹에 이용하므로 컴파일이 문제없이 동작할 것입니다. (물론 제대로 타입 선언을 해줬을 경우에만 이지만요) vscode와 같은 코드 편집기도 d.ts을 읽어 해석한 다음 코드 작성시 유용한 타입 힌트를 제공합니다.

DefinitelyTyped 에 있는 라이브러리가 하는 일이 방금 저희가 한 일입니다.
예를 들어 @types/react 를 `npm install -D` 하면 node_modules/@types/react 에 index.d.ts, global.d.ts 가 설치됩니다. 여기에 리액트의 컴포넌트, 훅에 대한 타입이 정의가 되어 있습니다. 그리고 tsc는 별도의 설정을 해주지 않더라도 node_modules/@types 디렉토리에 있는 타입 선언을 타입 체킹에 이용합니다.
또한 vscode는 index.d.ts, global.d.ts를 이용하여 타입 힌트를 제공합니다.

즉, 타입 선언은 타입스크립트에 "자바스크립트에는 이런저런 정보가 정의되어 있어"라고 알려주는 수단으로 생각할 수 있습니다.

### ts로 작성된 서드 파티 라이브러리

서드 파티 라이브러리는 사실 ts로 작성되더라도 js + d.ts 로 배포되는 것이 일반적입니다.

ts 파일을 공개하여, 라이브러리 사용자가 ts를 컴파일할 때 라이브러리 코드도 포함해서 컴파일하게 할 수도 있으나, js + d.ts로 배포하면 라이브러리 파일을 또 컴파일할 필요가 없어 컴파일 시간을 크게 줄여줍니다. d.ts 파일이 있으므로 당연히 타입 관점에서 동일한 기능을 제공할 수 있습니다.

### 프로젝트 어디에서나 전역으로 이용할 수 있는 타입을 정의하여 임포트 없이 바로 사용하고자 할 때

앰비언트 타입 선언은 영향 범위가 전역입니다. 따라서 앰비언트 타입 선언으로 타입을 선언하면 모든 코드 내에서 import 하지 않고 사용할 수 있습니다. 예를 들어 정말 유용한 타입 유틸 함수를 작성했다고 가정해보겠습니다. 너무 많은 코드에 쓰여서 일일히 코드에 import 하기가 지겨울 정도라고 하겠습니다. 그렇다면 앰비언트 타입 선언으로 타입 유틸 함수를 선언한다면 더이상 명시적으로 모든 코드에 import하지 않더라도 사용할 수 있습니다. 마치 내장 타입 유틸 함수인 것 처럼 말이죠.

### 자바스크립트 어딘가에 전역 변수가 정의되어 있음을 타입스크립트에 알릴 때

<!-- 자바스크립트 어딘가에 전역 변수가 정의되어 있음을 타입스크립트에 알림: 앰비언트 변수 선언 -->

타입스크립트로 직접 구현하지는 않았지만 실제로는 자바스크립트 어딘가에 전역 변수가 정의되어 있음을 타입스크립트에 알릴 때 사용합니다.

예를 들어 웹뷰 개발시 네이티브앱과의 통신을 위한 인터페이스를 네이티브앱이 윈도우 객체에 추가하는 경우가 많습니다. 즉, 타입스크립트로 직접 구현을 하지는 않았지만 실제로 해당 변수(자바스크립트의 함수는 일급 객체이므로 변수의 범위에 함수도 당연히 포함됩니다)가 정의되어 있어 런타임에서 해당 변수를 사용할 수 있습니다.

## 언제 앰비언트 타입 선언을 사용하는 것이 좋은가?

### ❌ 라이브러리 개발시

ts로 개발한 후 tsc설정에 ...을 추가하면 빌드된 js 파일과 d.ts 파일을 방출합니다. 따라서 수동으로 d.ts를 작성할 필요가 없습니다.

### ❌ 프로젝트 어디에서나 전역으로 이용할 수 있는 타입을 정의하여 임포트 없이 바로 사용하기 위해

앰비언트 타입 선언은 마치 프로토타입에 메서드를 추가하는 것과 같습니다. 일반 .ts 파일에 작성하고 명시적으로 import 하는 걸 추천한다. 명시적인 import, export가 보이지 않기 때문에.
의존성 관계가 보이지 않는다. 소스 코드의 규모가 큰 경우, 변경이 어려울 수 있습니다.

### 🤔 DefinitelyTyped에 타입 선언이 존재하지 않는 라이브러리에 타입 추가시

이런 라이브러리는 사용하지 않는 것이 좋습니다. 다른 대안을 찾아보세요. 타입을 직접 추가하면서까지 사용해야하는 라이브러리를 사용하자고 동료들을 설득하는 것은 라이브러리에 타입을 추가하는 것보다 더 힘든 일입니다.

### ✅ ts로 선언되지는 않았지만 구동환경에서 주입되는 것들에 대한 인터페이스 정의시 사용

- webpack 등의 번들러는 json, css, image 파일등을 모듈로 취급하게 해준다. 이러한 모듈의 타입을 앰비언트 모듈 선언을 한다면 ...

- 전역 변수 확장. 웹뷰 개발시 네이티브앱과의 통신을 위한 인터페이스를 윈도우 객체에 추가하는 경우가 많다. 이러한 경우에 유용.

- SDK 같은 걸 제공해주는 외부 라이브러리라면 d.ts도 제공해줄 것을 요청해야 한다. 외부 서드 파티와 같은 것. 위의 네이티브앱은 같은 회사에 앱팀이 존재하는 경우에 한정. 원활한 커뮤니케이션으로 변경점에 대해서 알림받을 수 있고 바로바로 확인 가능한 경우에 한정.

## 잘못 썼을 때 문제점

1. 앰비언트 선언은 의존성 관계가 보이지 않는다. 명시적인 import, export가 보이지 않기 때문에.
   소스 코드의 규모가 큰 경우, 변경이 어려울 수 있다.

2. 구동 환경에 대한 인터페이스를 수동으로 관리할 때는 잘 해야한다. 특히나 구동 환경의 변경시점과 코드 배포 시점을 맞추지 않는다면 (싱크가 안맞다면) 대참사가 일어난다.

3. 타입 선언과 구현을 따로 가지고 갈 필요가 없다. 타입스크립트의 큰 특징은 덕 타이핑이다. 타입 주도 개발과 시그니쳐를 먼저 설정하는 것의 차이를 명확히 알고, 모든 타입을 다 선언하고 관계를 다 그린이후에 개발을 하려고 하지 않아도 된다. 이는 애자일에도 맞지 않음. 적절한 수준의 중복이 성급한 추상화보다 훨씬 낫다는걸 깨닫게 된다.

4. 목적에 맞는 파일. 파일 목록만 봐도 이해가 되는...
// ambient type declaration(d.ts)와 일반 ts(x) 파일의 공존
충분히 작은 크기라서 이해는 되나... d.ts 파일이 있다면 구동 환경에 대한 인터페이스가 있다는 것을 다른 개발자가 바로 이해할 것. 또한 이게 크게 자라나더라도 대응할 수 있을거
<!--

---

정적 타입 언어를 주로 사용하던 개발자가 타입스크립트를 개발하게 되면
타입스크립트를 처음 접하게 하게 되면 타입 주도 개발을 하고 싶다는 강한 욕망에 빠집니다. 타입을 먼저 정의하고 이들간의 관계를 설계한 후에, 구현체를 만들겠다고 말이죠.
완전히 새로운 것을 만들지 않는 이상 완전 새로운 파일에서 새로운 모델을 만들어 낼 일은 거의 없습니다. 기존에 정의되어 있는 타입들을 이해하고 그들관의 관계를 이해한 후, 특정 필드를 추가하거나 하는 등의 일이 대부분입니다.

어찌되었건 타입 주도 개발을 하기로 했다고 하겠습니다. 그러면 정적 타입 언어, 주로 C, C++을 개발해봤던 개발자라면 헤더파일에 타입을 정의하듯, `.d.ts` 파일에 타입을 정의하는 거겠다고 생각합니다.
근데, 대부분의 타입스크립트 책에서 `.d.ts` 가 앞단원에 나오는 일은 없죠.
대부분의 타입 관련 선언, 사용은 `.ts, .tsx` 파일의 사용에서 충분합니다.

타입 주도 개발(모델 주도 개발) -> 추상체인 타입을 먼저 선언하고 이들 간의 관계를 정의한 후 구현체를 만들고자 하는 욕망
C와 같은 정적 언어를 사용한 사람은 `d.ts`를 헤더파일로 생각하여 `d.ts`에 모든 타입 선언을 하고자 한다.
그러나 실제로 `d.ts`는 사용될 일이 거의 없다.
언제 `d.ts`의 용도는 무엇이고, 언제 쓰는게 좋은지, 만약 잘못 쓰면 어떤 잘못이 있는지 알아본다.

## `d.ts`의 용도

d.ts 에는 타입 선언만 할 수 있고 구현은 할 수 없다.
class는 타입으로도 값으로도 사용되지만, d.ts 안에서는 타입만 선언할 수 있다.

- d.ts 에서는 타입만 포함할 수 있고 값은 표현할 수 없다.
- 값을 정의할 수는 없지만, declare 라는 특별 키워드를 사용해 JS의 다른 어딘가에 값이 있다는 사실을 선언할 수 있다.
  - declare는 "나의 자바스크립트는 이 타입을 익스포트함을 맹세한다"라고 선언하는 것이라 생각하자.
- 전역으로 선언된다. 명시적으로 import 하지 않더라도 소스 코드내 어디에서든 사용할 수 있다.

`.ts` 파일안에서 타입 선언도 할 수 있고 구현도 할 수 있는데 왜 `d.ts`가 필요한 걸까

라이브러리 개발자라고 생각해보자. ts로 개발한 경우에 이를 배포할 때 두가지 방법이 있다.

1. ts 파일을 공개하여, 라이브러리 사용자가 ts를 컴파일할 때 라이브러리 코드도 포함해서 컴파일하기
2. 컴파일된 js파일과 d.ts 파일을 공개하기. tsc(컴파일러)는 자동으로 d.ts 파일을 검색해서 타입 체킹시 이용한다. 코드 편집기도 d.ts을 읽어 해석한 다음 코드 작성시 유용한 타입 힌트를 제공한다. 무엇보다 라이브러리 파일을 또 컴파일할 필요가 없어 컴파일 시간을 크게 줄여준다.

JS파일이라도 이에 해당하는 d.ts 파일만 있으면 ts파일과 동일하게 타입체킹을 할 수 있으므로.
tsc는 컴파일 시 d.ts를 자동으로 생성해주는 옵션이 있다.

타입 선언은 타입스크립트에 "자바스크립트에는 이런저런 정보가 정의되어 있어"라고 알려주는 수단이다.
값을 포함하는 일반적인 선언과 구별하기 위해 타입 선언에 앰비언트(ambient; 주위의, 주변의)라는 표현을 쓰기도 한다.
예를 들어 앰비언트 변수 선언은 변수가 자바스크립트 어딘가에 선언되어 있음을 알려주기 위해 `declare` 키워드를 이용하는 반면, 일반 변수 선언에서는 declare 키워드를 쓰지 않고 let이나 const로 변수를 정의한다.
그러나 타입, 인터페이스에는 declare키워드를 이용하지 않아도 된다.

타입 선언이 사용되는 상황

1. 자바스크립트 어딘가에 전역 변수가 정의되어 있음을 타입스크립트에 알림: 앰비언트 변수 선언

2. 프로젝트 어디에서나 전역으로 이용할 수 있는 타입을 정의하여 임포트 없이 바로 사용하고자 할 때: 앰비언트 타입 선언

3. 타입스크립트에 NPM으로 설치한 서드 파티 모듈이 있음을 알릴 때: 앰비언트 모듈 선언

## 언제 사용하는 것이 좋은가?

ts로 선언되지는 않았지만 구동환경에서 주입되는 것들에 대한 인터페이스 정의시에만 사용한다.

구현체를 우리가 컨트롤 할 수 없는 경우에만 타입 선언이 유용하다.

- 앰비언트 모듈 선언: 사실상 @types가 있는 라이브러리 / d.ts를 같이 배포하는 라이브러리만을 사용한다. 임의로 라이브러리의 타입을 바꾸는 것은 위험하다. => 현업에서 거의 없다

  - webpack 등의 번들러는 json, css, image 파일등을 모듈로 취급하게 해준다. 이러한 모듈의 타입을 앰비언트 모듈 선언을 한다면 ...

- 앰비언트 타입 선언: 타입 유틸 함수 등이 유일한 경우. 전역으로 선언된다는 걸 명심하자. 앰비언트 타입 선언은 마치 프로토타입에 메서드를 추가하는 것과 같다. 일반 .ts 파일에 작성하고 명시적으로 import 하는 걸 추천한다
  구현체를 우리가 컨트롤 할 수 없는 경우에만 타입 선언이 유용하다.

- 앰비언트 변수 선언: 전역 변수 확장. 웹뷰 개발시 네이티브앱과의 통신을 위한 인터페이스를 윈도우 객체에 추가하는 경우가 많다. 이러한 경우에 유용. -->
